(()=>{"use strict";var t={92:(t,e,r)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.Querier=e.CWSimulateApp=void 0;const n=r(101),s=r(543),a=r(507),o=r(238),i=r(365),c=r(766),d=r(430),u=r(882),l=r(989),h=(0,s.Ok)({events:[],data:null});class p{[c.SERDE]="cw-simulate-app";chainId;bech32Prefix;backendApi;debug;env;handleCustomMsg;store;kvIterStorageRegistry;wasm;bank;ibc;querier;constructor(t){this.chainId=t.chainId,this.bech32Prefix=t.bech32Prefix,this.backendApi=t.backendApi??new n.BasicBackendApi(this.bech32Prefix),t.metering&&(this.env=new n.Environment(this.backendApi,t.gasLimit)),this.kvIterStorageRegistry=t.kvIterStorageRegistry??n.BinaryKVIterStorage,this.debug=t.debug??u.printDebug,this.handleCustomMsg=t.handleCustomMsg,this.store=new i.Transactional(this.kvIterStorageRegistry===n.BinaryKVIterStorage?(0,l.SortedMap)(n.compare):(0,l.Map)()).lens().initialize({height:1,time:1e6*Date.now()}),this.wasm=new a.WasmModule(this),this.bank=new o.BankModule(this),this.ibc=new d.IbcModule(this),this.querier=new f(this)}get gasUsed(){return this.env?.gasUsed??0}get gasLimit(){return this.env?.gasLimit??0}async handleMsg(t,e,r=[]){return"wasm"in e?await this.wasm.handleMsg(t,e.wasm,r):"bank"in e?await this.bank.handleMsg(t,e.bank):"ibc"in e?await this.ibc.handleMsg(t,e.ibc):"stargate"in e||"custom"in e||"gov"in e||"staking"in e||"distribution"in e?this.handleCustomMsg?.(e)??h:(0,s.Err)(`unknown message: ${JSON.stringify(e)}`)}pushBlock(t){return this.store.tx((e=>{e("height")(this.height+1);const r=1e6*Date.now();return this.time<r&&e("time")(r),t()}))}get height(){return this.store.get("height")}get time(){return this.store.get("time")}}e.CWSimulateApp=p;class f extends n.QuerierBase{app;constructor(t){super(),this.app=t}handleQuery(t){if("bank"in t)return this.app.bank.handleQuery(t.bank);if("wasm"in t)return this.app.wasm.handleQuery(t.wasm);throw new Error("Unknown query message")}}e.Querier=f},804:(t,e,r)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.SimulateCosmWasmClient=void 0;const n=r(799),s=r(92),a=r(387),o=r(567),i=r(989),c=r(255),d=r(882),u=r(101),l=r(507);class h extends n.SigningCosmWasmClient{static async from(t){const e=await(0,c.load)(Uint8Array.from(t));return new h(e)}app;constructor(t){super(null,null,{}),t instanceof s.CWSimulateApp?this.app=t:this.app=new s.CWSimulateApp(t)}toBytes(){return(0,c.save)(this.app)}async loadContract(t,e,r){this.app.wasm.setContractInfo(t,e),this.app.wasm.setContractStorage(t,(0,i.isMap)(r)?r:this.app.kvIterStorageRegistry===u.BinaryKVIterStorage?(0,i.SortedMap)(r,u.compare):(0,i.Map)(r)),await this.app.wasm.getContract(t).init()}getChainId(){return Promise.resolve(this.app.chainId)}getHeight(){return Promise.resolve(this.app.height)}getAccount(t){return Promise.resolve({address:t,pubkey:null,accountNumber:0,sequence:0})}getSequence(t){return Promise.resolve({accountNumber:0,sequence:0})}getBlock(t){return Promise.resolve({id:"",header:{version:{app:"simulate",block:"simulate"},height:t,chainId:this.app.chainId,time:(new Date).toString()},txs:[]})}getBalance(t,e){const r=this.app.bank.getBalance(t).find((t=>t.denom===e))??{denom:e,amount:"0"};return Promise.resolve(r)}getCodes(){const t=[];return this.app.wasm.forEachCodeInfo(((e,r)=>{t.push({id:r,creator:e.creator,checksum:l.WasmModule.checksumCache[r]})})),Promise.resolve(t)}getCodeDetails(t){const e=this.app.wasm.getCodeInfo(t),r={id:t,creator:e.creator,checksum:l.WasmModule.checksumCache[t],data:e.wasmCode};return Promise.resolve(r)}getContract(t){const e=this.app.wasm.getContractInfo(t);return Promise.resolve({address:t,codeId:e.codeId,creator:e.creator,admin:e.admin,label:e.label,ibcPortId:void 0})}sendTokens(t,e,r,n,s){const a=this.app.bank.send(t,e,r??[]);return Promise.resolve({height:this.app.height,txIndex:0,code:a.ok?0:1,transactionHash:(0,d.getTransactionHash)(this.app.height,a),events:[],rawLog:"string"==typeof a.val?a.val:void 0,gasUsed:66e3,gasWanted:this.app.gasLimit,msgResponses:[]})}upload(t,e,r,n){const s=(0,o.toHex)((0,a.sha256)(e)),i=this.app.wasm.create(t,e);return l.WasmModule.checksumCache[i]=s,Promise.resolve({originalSize:e.length,compressedSize:e.length,checksum:s,codeId:i,logs:[],height:this.app.height,transactionHash:(0,d.getTransactionHash)(this.app.height,s),events:[],gasWanted:this.app.gasLimit,gasUsed:10*e.length})}async instantiate(t,e,r,n,s,a){const o=this.app.gasUsed,i=await this.app.wasm.instantiateContract(t,a?.funds??[],e,r,n,a?.admin,void 0);if(i.err||"string"==typeof i.val)throw new Error(i.val.toString());return{contractAddress:i.val.events[0].attributes[0].value,logs:[],height:this.app.height,transactionHash:(0,d.getTransactionHash)(this.app.height,i),events:i.val.events,gasWanted:this.app.gasLimit,gasUsed:this.app.gasUsed-o}}async executeMultiple(t,e,r,n){const s=[],a=this.app.gasUsed,o=await Promise.all(e.map((({contractAddress:e,funds:r,msg:n})=>this.app.wasm.executeContract(t,r??[],e,n))));for(const t of o){if(t.err||"string"==typeof t.val)throw new Error(t.val.toString());s.push(...t.val.events)}return{logs:[],height:this.app.height,transactionHash:(0,d.getTransactionHash)(this.app.height,o),events:s,gasWanted:this.app.gasLimit,gasUsed:this.app.gasUsed-a}}async execute(t,e,r,n,s,a){return this.executeMultiple(t,[{contractAddress:e,msg:r,funds:a}],n,s)}async migrate(t,e,r,n,s,a){const{admin:o}=this.app.wasm.getContractInfo(e);if(o!==t)throw new Error("unauthorized: can not migrate");const i=this.app.gasUsed,c=await this.app.wasm.migrateContract(t,r,e,n);if(c.err||"string"==typeof c.val)throw new Error(c.val.toString());return{logs:[],height:this.app.height,transactionHash:(0,d.getTransactionHash)(this.app.height,c),events:c.val.events,gasWanted:this.app.gasLimit,gasUsed:this.app.gasUsed-i}}async queryContractRaw(t,e){const r=this.app.wasm.handleQuery({raw:{contract_addr:t,key:(0,n.toBinary)(e)}});return Promise.resolve((0,o.fromBase64)((0,n.toBinary)({ok:r})))}async queryContractSmart(t,e){const r=this.app.wasm.query(t,e);return r.ok?Promise.resolve(r.val):Promise.reject(new Error(r.val))}}e.SimulateCosmWasmClient=h},183:function(t,e,r){var n=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0}),e.DownloadState=e.BufferCollection=e.BufferIter=e.BufferStream=void 0;const s=n(r(17)),a=n(r(147)),o=r(101),i=r(989);class c{filePath;fd;sizeBuf;constructor(t,e){this.filePath=t,e&&a.default.existsSync(t)?(this.fd=a.default.openSync(t,"r+"),this.sizeBuf=Buffer.allocUnsafe(4),a.default.readSync(this.fd,this.sizeBuf,0,4,0)):(this.sizeBuf=Buffer.alloc(4),a.default.writeFileSync(t,this.sizeBuf),this.fd=a.default.openSync(t,"r+"))}increaseSize(){for(let t=this.sizeBuf.length-1;t>=0;--t){if(255!==this.sizeBuf[t]){this.sizeBuf[t]++;break}this.sizeBuf[t]=0}}get size(){return this.sizeBuf.readUInt32BE()}close(){a.default.closeSync(this.fd)}write(t){let e=0;for(const[r,n]of t)e+=r.length+n.length+3;const r=Buffer.allocUnsafe(e);let n=0;for(const[e,s]of t)r[n++]=e.length,r.set(e,n),n+=e.length,r[n++]=s.length>>8&255,r[n++]=255&s.length,r.set(s,n),n+=s.length,this.increaseSize();a.default.writeSync(this.fd,this.sizeBuf,0,4,0),a.default.appendFileSync(this.filePath,r)}}e.BufferStream=c;class d{buf;size;ind=0;bufInd=0;constructor(t,e){this.buf=t,this.size=e}reset(){return this.ind=0,this.bufInd=0,this}next(){if(this.ind===this.size)return{done:!0};const t=this.buf[this.bufInd++],e=this.buf.subarray(this.bufInd,this.bufInd+=t),r=this.buf[this.bufInd++]<<8|this.buf[this.bufInd++],n=this.buf.subarray(this.bufInd,this.bufInd+=r);return this.ind++,{value:[e,n]}}}e.BufferIter=d;class u{size;buf;constructor(t){this.size=(0,o.toNumber)(t.subarray(0,4)),this.buf=t.subarray(4)}entries(){return new d(this.buf,this.size)}}e.BufferCollection=u,u.prototype["@@__IMMUTABLE_KEYED__@@"]=!0,e.DownloadState=class{lcd;downloadPath;constructor(t,e){this.lcd=t,this.downloadPath=e}async saveState(t,e){const r=new c(s.default.join(this.downloadPath,`${t}.state`),!!e);await new Promise((n=>{(async(t,e,r,n,s,a=5e3)=>{let o=s;for(;;){const s=new URL(`${t}/cosmwasm/wasm/v1/contract/${e}/state`);s.searchParams.append("pagination.limit",a.toString()),o&&(s.searchParams.append("pagination.key",o),console.log("nextKey",o));try{const{models:t,pagination:e}=await fetch(s.toString(),{signal:AbortSignal.timeout(3e4)}).then((t=>t.json()));if(r(t),!(o=e.next_key))return n()}catch(t){await new Promise((t=>setTimeout(t,1e3)))}}})(this.lcd,t,(t=>{const e=t.map((({key:t,value:e})=>[Buffer.from(t,"hex"),Buffer.from(e,"base64")]));r.write(e)}),n,e)})),r.close();const n=s.default.join(this.downloadPath,t);if(!a.default.existsSync(n)){const{contract_info:{code_id:e}}=await fetch(`${this.lcd}/cosmwasm/wasm/v1/contract/${t}`).then((t=>t.json())),{data:r}=await fetch(`${this.lcd}/cosmwasm/wasm/v1/code/${e}`).then((t=>t.json()));a.default.writeFileSync(n,Buffer.from(r,"base64"))}console.log("done")}loadStateData(t){const e=a.default.readFileSync(s.default.join(this.downloadPath,`${t}.state`));return i.SortedMap.rawPack(new u(e),o.compare)}async loadState(t,e,r,n,o){const{codeId:i}=await t.upload(e,a.default.readFileSync(s.default.join(this.downloadPath,r)),"auto");await t.loadContract(r,{codeId:i,admin:e,label:n,creator:e,created:1},o??this.loadStateData(r))}}},607:function(t,e,r){var n=this&&this.__createBinding||(Object.create?function(t,e,r,n){void 0===n&&(n=r);var s=Object.getOwnPropertyDescriptor(e,r);s&&!("get"in s?!e.__esModule:s.writable||s.configurable)||(s={enumerable:!0,get:function(){return e[r]}}),Object.defineProperty(t,n,s)}:function(t,e,r,n){void 0===n&&(n=r),t[n]=e[r]}),s=this&&this.__exportStar||function(t,e){for(var r in t)"default"===r||Object.prototype.hasOwnProperty.call(e,r)||n(e,t,r)};Object.defineProperty(e,"__esModule",{value:!0}),e.SortedSet=e.SortedMap=void 0,s(r(92),e),s(r(804),e),s(r(699),e),s(r(527),e),s(r(370),e),s(r(255),e),s(r(183),e),s(r(101),e),s(r(543),e);var a=r(989);Object.defineProperty(e,"SortedMap",{enumerable:!0,get:function(){return a.SortedMap}}),Object.defineProperty(e,"SortedSet",{enumerable:!0,get:function(){return a.SortedSet}})},337:(t,e,r)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.CWSimulateVMInstance=void 0;const n=r(101);class s extends n.VMInstance{logs;debugFn;constructor(t,e,r,n){super(r,n),this.logs=t,this.debugFn=e}processLog(t){this.logs.push(t),this.debugFn(t)}do_db_read(t){const e=super.do_db_read(t);return this.processLog({type:"call",fn:"db_read",args:{key:t.str},result:e.str}),e}do_db_write(t,e){super.do_db_write(t,e),this.processLog({type:"call",fn:"db_write",args:{key:t.str,value:e.str}})}do_db_remove(t){super.do_db_remove(t),this.processLog({type:"call",fn:"db_remove",args:{key:t.str}})}do_db_scan(t,e,r){let n=super.do_db_scan(t,e,r);return this.processLog({type:"call",fn:"db_scan",args:{start:t.str,end:e.str,order:r},result:n.str}),n}do_db_next(t){let e=super.do_db_next(t);return this.processLog({type:"call",fn:"db_next",args:{iterator_id:t.str},result:e.str}),e}do_addr_humanize(t,e){let r=super.do_addr_humanize(t,e);return this.processLog({type:"call",fn:"addr_humanize",args:{source:t.str},result:r.str}),r}do_addr_canonicalize(t,e){let r=super.do_addr_canonicalize(t,e);return this.processLog({type:"call",fn:"addr_canonicalize",args:{source:t.str,destination:e.str},result:r.str}),r}do_addr_validate(t){let e=super.do_addr_validate(t);return this.processLog({type:"call",fn:"addr_validate",args:{source:t.str},result:e.str}),e}do_secp256k1_verify(t,e,r){let n=super.do_secp256k1_verify(t,e,r);return this.processLog({type:"call",fn:"secp256k1_verify",args:{hash:t.str,signature:e.str,pubkey:r.str},result:n}),n}do_secp256k1_recover_pubkey(t,e,r){let n=super.do_secp256k1_recover_pubkey(t,e,r);return this.processLog({type:"call",fn:"secp256k1_recover_pubkey",args:{msgHash:t.str,signature:e.str,recover_param:r},result:n.str}),n}do_abort(t){super.do_abort(t),this.processLog({type:"call",fn:"abort",args:{message:t.read_str()}})}do_debug(t){const e=t.read_str();this.processLog({type:"call",fn:"debug",args:{message:e}}),super.do_debug(t),this.processLog({type:"print",message:e})}do_ed25519_batch_verify(t,e,r){let n=super.do_ed25519_batch_verify(t,e,r);return this.processLog({type:"call",fn:"ed25519_batch_verify",args:{messages_ptr:t.str,signatures_ptr:e.str,pubkeys_ptr:r.str},result:n}),n}do_ed25519_verify(t,e,r){let n=super.do_ed25519_verify(t,e,r);return this.processLog({type:"call",fn:"ed25519_verify",args:{message:t.str,signature:e.str,pubkey:r.str},result:n}),n}do_query_chain(t){let e=super.do_query_chain(t);return this.processLog({type:"call",fn:"query_chain",args:{request:t.str},result:e.str}),e}resetDebugInfo(){return this.debugMsgs=[],this.logs=[],this}}e.CWSimulateVMInstance=s},238:(t,e,r)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.lensFromSnapshot=e.ParsedCoin=e.BankModule=void 0;const n=r(543),s=r(365);e.BankModule=class{chain;store;constructor(t){this.chain=t,this.store=this.chain.store.db.lens("bank").initialize({balances:{}})}send(t,e,r){return this.store.tx((()=>{let s=this.getBalance(t).map(a.fromCoin).filter((t=>t.amount>0));const o=r.map(a.fromCoin).filter((t=>t.amount>0));for(const e of o){const r=s.find((t=>t.denom===e.denom));if(!(r&&r.amount>=e.amount))return(0,n.Err)(`Sender ${t} has ${r?.amount??0} ${e.denom}, needs ${e.amount}`);r.amount-=e.amount}s=s.filter((t=>t.amount>0));const i=this.getBalance(e).map(a.fromCoin);for(const t of o){const e=i.find((e=>e.denom===t.denom));e?e.amount+=t.amount:i.push(t)}return this.setBalance(t,s.map((t=>t.toCoin()))),this.setBalance(e,i.map((t=>t.toCoin()))),(0,n.Ok)(void 0)}))}burn(t,e){return this.store.tx((()=>{let r=this.getBalance(t).map(a.fromCoin),s=e.map(a.fromCoin).filter((t=>t.amount>0));for(const e of s){const s=r.find((t=>t.denom===e.denom));if(!(s&&s.amount>=e.amount))return(0,n.Err)(`Sender ${t} has ${s?.amount??0} ${e.denom}, needs ${e.amount}`);s.amount-=e.amount}return r=r.filter((t=>t.amount>0)),this.setBalance(t,r.map((t=>t.toCoin()))),(0,n.Ok)(void 0)}))}mint(t,e){return this.store.tx((()=>{let r=this.getBalance(t).map(a.fromCoin),s=e.map(a.fromCoin).filter((t=>t.amount>0));for(const t of s){const e=r.find((e=>e.denom===t.denom));e?e.amount+=t.amount:r.push(t)}return r=r.filter((t=>t.amount>0)),this.setBalance(t,r.map((t=>t.toCoin()))),(0,n.Ok)(void 0)}))}setBalance(t,e){this.store.tx((r=>(r("balances",t)(e),(0,n.Ok)(void 0))))}getBalance(t,e){return this.lens(e).getObject("balances",t)??[]}getBalances(){return this.store.getObject("balances")}deleteBalance(t){this.store.tx(((e,r)=>(r("balances",t),(0,n.Ok)(void 0))))}async handleMsg(t,e){return"send"in e?this.send(t,e.send.to_address,e.send.amount).andThen((()=>(0,n.Ok)({events:[{type:"transfer",attributes:[{key:"recipient",value:e.send.to_address},{key:"sender",value:t},{key:"amount",value:JSON.stringify(e.send.amount)}]}],data:null}))):"burn"in e?this.burn(t,e.burn.amount).andThen((()=>(0,n.Ok)({events:[{type:"burn",attributes:[{key:"sender",value:t},{key:"amount",value:JSON.stringify(e.burn.amount)}]}],data:null}))):(0,n.Err)("Unknown bank message")}handleQuery(t){let e=t;if("balance"in e){let{address:t,denom:r}=e.balance;return{amount:this.getBalance(t).find((t=>t.denom===r))??{denom:r,amount:"0"}}}if("all_balances"in e){let{address:t}=e.all_balances;return{amount:this.getBalance(t)}}throw new Error("Unknown bank query")}lens(t){return t?o(t):this.store}};class a{denom;amount;constructor(t,e){this.denom=t,this.amount=e}toCoin(){return{denom:this.denom,amount:this.amount.toString()}}static fromCoin(t){return new a(t.denom,BigInt(t.amount))}}function o(t){return new s.Transactional(t).lens("bank")}e.ParsedCoin=a,e.lensFromSnapshot=o},430:function(t,e,r){var n=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0}),e.IbcModule=e.ibcDenom=void 0;const s=n(r(502)),a=r(543),o=r(699),i=r(567),c=r(387),d=new s.default,u=new Map,l=new Map,h=new Map,p=new Map;function f(...t){return t.join(":")}e.ibcDenom=(t,e,r)=>"ibc/"+(0,i.toHex)((0,c.sha256)((0,i.toUtf8)(`${t}/${e}/${r}`))).toUpperCase(),e.IbcModule=class{chain;sequence=0;constructor(t){this.chain=t,this.handleRelayMsg=this.handleRelayMsg.bind(this)}addMiddleWare(t){h.get(this.chain.chainId).push(t)}removeMiddelWare(t){const e=h.get(this.chain.chainId),r=e.findIndex((e=>e===t));-1!==r&&e.splice(r,1)}relay(t,e,r,n,s){this.innerRelay(t,e,r,n,s),s.ibc.innerRelay(r,n,t,e,this.chain)}getContractIbcPort(t){const e=`wasm.${t}`;for(const t of l.values())if(t.source_port_id===e)return e;return null}async handleRelayMsg(t){const[r,n,s]=u.get(t.id);try{let n=[],a=null;const{chain:o}=l.get(f(this.chain.chainId,t.endpoint.channel_id)),i=h.get(o.chainId);if("transfer"===t.type){const r=t.data;let n;this.chain.bank.burn(r.sender,[r.token]),r.token.denom.startsWith("ibc/")?n=p.get(r.token.denom):(n=(0,e.ibcDenom)("transfer",t.counterparty_endpoint.channel_id,r.token.denom),p.set(n,r.token.denom)),o.bank.mint(r.receiver,[{denom:n,amount:r.token.amount}]),a={events:[],data:null}}else if(t.counterparty_endpoint.port_id.startsWith("wasm.")){const e=t.counterparty_endpoint.port_id.substring(5),r=o.wasm.getContract(e);if(!(t.type in r))throw new Error(`Contract ${e} does not have entrypoint ${t.type}`);const s=r[t.type](t.data,n);if(s.err)throw new Error(s.val);a=await o.wasm.handleIbcResponse(r.address,s.val)}else if(!i.length)throw new Error(`Method ${t.type} has not been implemented on chain ${o.chainId}`);a||(a={events:[],data:null});for(const e of i)await e(t,a);r&&r(a)}catch(t){n&&n(t)}finally{clearTimeout(s),u.delete(t.id)}}async handleMsg(t,e){if("send_packet"in e){const r=l.get(f(this.chain.chainId,e.send_packet.channel_id));if(!r)throw new Error("Chain is not relayed yet");return(await this.chain.store.tx((async()=>{try{const n=await this.sendPacketReceive({packet:{data:e.send_packet.data,src:{port_id:r.source_port_id,channel_id:e.send_packet.channel_id},dest:{port_id:r.port_id,channel_id:r.channel_id},sequence:this.sequence++,timeout:e.send_packet.timeout},relayer:t});return(0,a.Ok)(n)}catch(t){return(0,a.Err)(t.message)}}))).andThen((t=>(0,a.Ok)({...t,events:[...t.events,{type:"send_packet",attributes:[{key:"packet_data_hex",value:(0,i.toHex)((0,i.fromBase64)(e.send_packet.data))},{key:"packet_timeout_height",value:(e.send_packet.timeout.block?.height??0).toString()},{key:"packet_sequence",value:this.sequence.toString()},{key:"packet_timeout_timestamp",value:e.send_packet.timeout.timestamp??""},{key:"packet_src_channel",value:e.send_packet.channel_id},{key:"packet_src_port",value:r.source_port_id},{key:"packet_dest_channel",value:r.channel_id},{key:"packet_dest_port",value:r.port_id},{key:"packet_channel_ordering",value:o.IbcOrder.Unordered},{key:"connection_id",value:r.connection_id},{key:"action",value:"application-module-defined-field"},{key:"module",value:"ibc_channel"}]}],data:null})))}if("transfer"in e)return(await this.chain.store.tx((async()=>{try{const r={sender:t,channelId:e.transfer.channel_id,timeout:e.transfer.timeout,token:e.transfer.amount,receiver:e.transfer.to_address},n=await this.sendTransfer(r);return(0,a.Ok)(n)}catch(t){return(0,a.Err)(t.message)}}))).andThen((r=>(0,a.Ok)({...r,events:[...r.events,{type:"transfer",attributes:[{key:"recipient",value:e.transfer.to_address},{key:"sender",value:t},{key:"amount",value:`${e.transfer.amount.amount}${e.transfer.amount.denom}`},{key:"channel",value:e.transfer.channel_id}]}],data:null})));if("close_channel"in e){const r=l.get(f(this.chain.chainId,e.close_channel.channel_id));if(!r)throw new Error("Chain is not relayed yet");return(await this.chain.store.tx((async()=>{try{const t=await r.chain.ibc.sendChannelClose({close_init:{channel:{order:o.IbcOrder.Unordered,version:r.version,connection_id:r.connection_id,counterparty_endpoint:{channel_id:e.close_channel.channel_id,port_id:r.source_port_id},endpoint:{channel_id:r.channel_id,port_id:r.port_id}}}});return(0,a.Ok)(t)}catch(t){return(0,a.Err)(t.message)}}))).andThen((e=>(0,a.Ok)({...e,events:[...e.events,{type:"channel_close_init",attributes:[{key:"port_id",value:r.source_port_id},{key:"channel_id",value:t},{key:"counterparty_port_id",value:r.port_id},{key:"counterparty_channel_id",value:r.channel_id},{key:"connection_id",value:r.connection_id},{key:"action",value:"channel_close_init"},{key:"module",value:"ibc_channel"}]}],data:null})))}return(0,a.Err)("Unknown ibc message")}sendMsg(t,e,r,n){const s=f(this.chain.chainId,e.channel_id),a=Date.now().toString();return new Promise(((o,i)=>{const c=setTimeout((()=>i(new Error(`Call ${t} timeout after 2000`))),2e3);u.set(a,[o,i,c]),d.emit(s,{type:t,endpoint:e,counterparty_endpoint:r,data:n,id:a})}))}innerRelay(t,e,r,n,s){const a=f(this.chain.chainId,t);l.set(a,{channel_id:r,port_id:n,source_port_id:e,chain:s}),h.set(this.chain.chainId,[]),d.removeAllListeners(a),d.addListener(a,this.handleRelayMsg)}sendChannelOpen(t){const{endpoint:e,counterparty_endpoint:r}="open_init"in t?t.open_init.channel:t.open_try.channel;return this.sendMsg("ibc_channel_open",e,r,t)}sendChannelConnect(t){const{endpoint:e,counterparty_endpoint:r}="open_ack"in t?t.open_ack.channel:t.open_confirm.channel;if("open_ack"in t){const{channel:e}=t.open_ack,r=l.get(f(this.chain.chainId,e.endpoint.channel_id));r.version=e.version,r.connection_id=e.connection_id;const n=l.get(f(r.chain.chainId,e.counterparty_endpoint.channel_id));n.version=e.version,n.connection_id=e.connection_id}return this.sendMsg("ibc_channel_connect",e,r,t)}sendChannelClose(t){const{endpoint:e,counterparty_endpoint:r}="close_init"in t?t.close_init.channel:t.close_confirm.channel;return this.sendMsg("ibc_channel_close",e,r,t)}sendPacketReceive(t){return this.sendMsg("ibc_packet_receive",t.packet.src,t.packet.dest,t)}sendPacketAck(t){return this.sendMsg("ibc_packet_ack",t.original_packet.src,t.original_packet.dest,t)}sendPacketTimeout(t){return this.sendMsg("ibc_packet_timeout",t.packet.src,t.packet.dest,t)}sendTransfer(t){const e=l.get(f(this.chain.chainId,t.channelId));if(!e)throw new Error("Chain is not relayed yet");const r={port_id:e.source_port_id,channel_id:t.channelId},n={port_id:e.port_id,channel_id:e.channel_id};return this.sendMsg("transfer",r,n,t)}}},203:(t,e,r)=>{Object.defineProperty(e,"__esModule",{value:!0});const n=r(799),s=r(543),a=r(337),o=r(882),i=r(370),c=r(18);e.default=class{_wasm;address;_vm;constructor(t,e){this._wasm=t,this.address=e}async init(){if(!this._vm){const{_wasm:t,address:e}=this,r=t.getContractInfo(e);if(!r)throw new Error(`Contract ${e} not found`);const{codeId:n}=r,s=t.getCodeInfo(n);if(!s)throw new Error(`code ${n} not found`);const{wasmCode:o}=s,i=this.getStorage(),d=new t.chain.kvIterStorageRegistry(i),u={backend_api:t.chain.backendApi,storage:d,querier:t.chain.querier},l=[],h=new a.CWSimulateVMInstance(l,(e=>t.chain.debug?.(e)),u,t.chain.env);await h.build(o,c.WasmModule.checksumCache[n]),this._vm=h}return this}instantiate(t,e,r,n){try{if(!this._vm)return new i.ContractNotFoundError(this.address);const s=this._vm,a=this.getExecutionEnv(),c={sender:t,funds:e},d=(0,o.fromRustResult)(s.instantiate(a,c,r));return this.setStorage(s.backend.storage.dict),n.push(...s.logs),d}catch(t){return(0,s.Err)(t.message??t.toString())}}execute(t,e,r,n){try{if(!this._vm)return new i.ContractNotFoundError(this.address);const s=this._vm;s.resetDebugInfo();const a=this.getExecutionEnv(),c={sender:t,funds:e},d=(0,o.fromRustResult)(s.execute(a,c,r));return this.setStorage(s.backend.storage.dict),n.push(...s.logs),d}catch(t){return(0,s.Err)(t.message??t.toString())}}migrate(t,e){try{if(!this._vm)return new i.ContractNotFoundError(this.address);const r=this._vm,n=this.getExecutionEnv(),s=(0,o.fromRustResult)(r.migrate(n,t));return this.setStorage(r.backend.storage.dict),e.push(...r.logs),s}catch(t){return(0,s.Err)(t.message??t.toString())}}reply(t,e){try{if(!this._vm)return new i.ContractNotFoundError(this.address);const r=this._vm,n=(0,o.fromRustResult)(r.reply(this.getExecutionEnv(),t));return this.setStorage(r.backend.storage.dict),e.push(...r.logs),n}catch(t){return(0,s.Err)(t.message??t.toString())}}ibc_channel_open(t,e){try{if(!this._vm)return new i.ContractNotFoundError(this.address);const r=this._vm,n=(0,o.fromRustResult)(r.ibc_channel_open(this.getExecutionEnv(),t));return this.setStorage(r.backend.storage.dict),e.push(...r.logs),n}catch(t){return(0,s.Err)(t.message??t.toString())}}ibc_channel_connect(t,e){try{if(!this._vm)return new i.ContractNotFoundError(this.address);const r=this._vm,n=(0,o.fromRustResult)(r.ibc_channel_connect(this.getExecutionEnv(),t));return this.setStorage(r.backend.storage.dict),e.push(...r.logs),n}catch(t){return(0,s.Err)(t.message??t.toString())}}ibc_channel_close(t,e){try{if(!this._vm)return new i.ContractNotFoundError(this.address);const r=this._vm,n=(0,o.fromRustResult)(r.ibc_channel_close(this.getExecutionEnv(),t));return this.setStorage(r.backend.storage.dict),e.push(...r.logs),n}catch(t){return(0,s.Err)(t.message??t.toString())}}ibc_packet_receive(t,e){try{if(!this._vm)return new i.ContractNotFoundError(this.address);const r=this._vm,n=(0,o.fromRustResult)(r.ibc_packet_receive(this.getExecutionEnv(),t));return this.setStorage(r.backend.storage.dict),e.push(...r.logs),n}catch(t){return(0,s.Err)(t.message??t.toString())}}ibc_packet_ack(t,e){try{if(!this._vm)return new i.ContractNotFoundError(this.address);const r=this._vm,n=(0,o.fromRustResult)(r.ibc_packet_ack(this.getExecutionEnv(),t));return this.setStorage(r.backend.storage.dict),e.push(...r.logs),n}catch(t){return(0,s.Err)(t.message??t.toString())}}ibc_packet_timeout(t,e){try{if(!this._vm)return new i.ContractNotFoundError(this.address);const r=this._vm,n=(0,o.fromRustResult)(r.ibc_packet_timeout(this.getExecutionEnv(),t));return this.setStorage(r.backend.storage.dict),e.push(...r.logs),n}catch(t){return(0,s.Err)(t.message??t.toString())}}query(t,e){if(!this._vm)return new i.ContractNotFoundError(this.address);const r=this._vm,a=r.backend,c=new this._wasm.chain.kvIterStorageRegistry(this.getStorage(e));r.backend={...r.backend,storage:c};let d=this.getExecutionEnv();try{return(0,o.fromRustResult)(r.query(d,t)).andThen((t=>(0,s.Ok)((0,n.fromBinary)(t))))}catch(t){return(0,s.Err)(t.message??t.toString())}finally{this._vm.backend=a}}setStorage(t){this._wasm.setContractStorage(this.address,t)}getStorage(t){return this._wasm.getContractStorage(this.address,t)}getExecutionEnv(){return this._wasm.getExecutionEnv(this.address)}get vm(){return this._vm}get valid(){return!!this._vm}}},370:(t,e,r)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.GenericError=e.ContractNotFoundError=e.VmError=void 0;const n=r(543);class s extends n.ErrImpl{constructor(t){super(`VmError: ${t}`)}}e.VmError=s,e.ContractNotFoundError=class extends s{constructor(t){super(`contract ${t} not found`)}};class a extends Error{constructor(t){super(`Generic error: ${t}`)}}e.GenericError=a},507:function(t,e,r){var n=this&&this.__createBinding||(Object.create?function(t,e,r,n){void 0===n&&(n=r);var s=Object.getOwnPropertyDescriptor(e,r);s&&!("get"in s?!e.__esModule:s.writable||s.configurable)||(s={enumerable:!0,get:function(){return e[r]}}),Object.defineProperty(t,n,s)}:function(t,e,r,n){void 0===n&&(n=r),t[n]=e[r]}),s=this&&this.__exportStar||function(t,e){for(var r in t)"default"===r||Object.prototype.hasOwnProperty.call(e,r)||n(e,t,r)};Object.defineProperty(e,"__esModule",{value:!0}),s(r(18),e)},18:function(t,e,r){var n=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0}),e.lensFromSnapshot=e.WasmModule=void 0;const s=r(799),a=r(567),o=r(989),i=r(543),c=r(365),d=n(r(203)),u=r(411),l=r(101);class h{chain;static checksumCache={};store;contracts={};constructor(t){this.chain=t,this.store=t.store.db.lens("wasm").initialize({lastCodeId:0,lastInstanceId:0,codes:{},contracts:{},contractStorage:{}})}setContractStorage(t,e){this.store.tx((r=>(r("contractStorage",t)(e),(0,i.Ok)(void 0))))}getContractStorage(t,e){return this.lens(e).get("contractStorage",t)}setCodeInfo(t,e){this.store.tx((r=>(r("codes",t)(e),(0,i.Ok)(void 0))))}forEachCodeInfo(t,e){const{data:r}=this.lens(e).lens("codes");r.forEach(((e,r)=>{const n={creator:e.get("creator"),wasmCode:e.get("wasmCode")};t(n,Number(r))}))}getCodeInfo(t,e){const r=this.lens(e).lens("codes",t);if(r)return{creator:r.get("creator"),wasmCode:r.get("wasmCode")}}setContractInfo(t,e){this.store.tx((r=>(r("contracts",t)(e),(0,i.Ok)(void 0))))}getContractInfo(t,e){const r=this.lens(e).lens("contracts",t);if(r?.data)return r.data.toObject()}storeCode(t,e){return this.chain.pushBlock((()=>this.store.tx((r=>{let n={creator:t,wasmCode:e};const s=this.lastCodeId+1;return this.setCodeInfo(s,n),r("lastCodeId")(s),(0,i.Ok)(s)}))))}create(t,e){return this.storeCode(t,e).unwrap()}getExecutionEnv(t){return{block:{height:this.chain.height,time:this.chain.time.toFixed(),chain_id:this.chain.chainId},contract:{address:t}}}getContract(t){return this.contracts[t]||(this.contracts[t]=new d.default(this,t)),this.contracts[t]}getContracts(){return Object.values(this.contracts)}registerContractInstance(t,e,r="",n=null){return this.store.tx((s=>{const c=(0,u.buildContractAddress)(e,this.lastInstanceId+1),d=(0,a.toBech32)(this.chain.bech32Prefix,c),h={codeId:e,creator:t,admin:n,label:r,created:this.chain.height};return this.setContractInfo(d,h),this.setContractStorage(d,this.chain.kvIterStorageRegistry===l.BinaryKVIterStorage?(0,o.SortedMap)(l.compare):(0,o.Map)()),s("lastInstanceId")(this.lastInstanceId+1),(0,i.Ok)(d)}))}async instantiateContract(t,e,r,n,s,a=null,o=[]){return await this.chain.pushBlock((async()=>{const i=this.registerContractInstance(t,r,s,a).unwrap();let d=[];const l=await this.getContract(i).init(),h={[c.NEVER_IMMUTIFY]:!0,type:"instantiate",contractAddress:i,msg:n,info:{sender:t,funds:e},logs:d,env:l.getExecutionEnv(),storeSnapshot:this.store.db.data};if(e.length){const r=this.chain.bank.send(t,l.address,e);if(r.err)return o.push({...h,response:r,result:r}),r}let p=l.instantiate(t,e,n,d);if(p.err)return o.push({...h,response:p,result:p}),p;let f={type:"instantiate",attributes:[{key:"_contract_address",value:i},{key:"code_id",value:r.toString()}]};if("string"==typeof p.val)throw new Error(p.val.toString());let g=(0,u.buildAppResponse)(i,f,p.val),m=[],_=await this.handleContractResponse(i,p.val.messages,g,m);return o.push({...h,response:p,result:_,traces:m,storeSnapshot:this.store.db.data}),_}))}async migrateContract(t,e,r,n,s=[]){return await this.chain.pushBlock((async()=>{const a=this.getContract(r),o=this.getContractInfo(r);if(void 0===o)throw new Error(`Contract ${r} not found`);o.codeId=e,this.setContractInfo(r,o);const{wasmCode:i}=this.getCodeInfo(o.codeId);await a.vm.build(i,h.checksumCache[o.codeId]);const d=[],l={[c.NEVER_IMMUTIFY]:!0,type:"migrate",contractAddress:r,msg:n,info:{sender:t,funds:[]},logs:d,env:a.getExecutionEnv(),storeSnapshot:this.store.db.data};let p=a.migrate(n,d);if(p.err)return s.push({...l,response:p,result:p}),p;let f={type:"migrate",attributes:[{key:"_contract_address",value:r}]};if("string"==typeof p.val)throw new Error(p.val.toString());let g=(0,u.buildAppResponse)(r,f,p.val),m=[],_=await this.handleContractResponse(r,p.val.messages,g,m);return s.push({...l,response:p,result:_,traces:m,storeSnapshot:this.store.db.data}),_}))}async executeContract(t,e,r,n,s=[]){return await this.chain.pushBlock((async()=>{const a=await this.getContract(r).init(),o=[],i={[c.NEVER_IMMUTIFY]:!0,type:"execute",contractAddress:r,msg:n,logs:o,env:a.getExecutionEnv(),info:{sender:t,funds:e},storeSnapshot:this.store.db.data};if(e.length){const n=this.chain.bank.send(t,r,e);if(n.err)return s.push({...i,response:n,result:n}),n}const d=a.execute(t,e,n,o);if(d.err)return s.push({...i,response:d,result:d}),d;let l={type:"execute",attributes:[{key:"_contract_address",value:r}]};if("string"==typeof d.val)throw new Error(d.val.toString());let h=(0,u.buildAppResponse)(r,l,d.val),p=[],f=await this.handleContractResponse(r,d.val.messages,h,p);return s.push({...i,response:d,result:f,traces:p,storeSnapshot:this.store.db.data}),f}))}async handleIbcResponse(t,e,r=[]){return e?.messages&&await this.handleContractResponse(t,e.messages,e,r),e}async handleContractResponse(t,e,r,n=[]){for(const s of e){const e=await this.handleSubmsg(t,s,n);if(e.err)return e;if("string"==typeof e.val)throw new Error(e.val.toString());r.events=[...r.events,...e.val.events],null!==e.val.data&&(r.data=e.val.data)}return(0,i.Ok)({events:r.events,data:r.data})}async handleSubmsg(t,e,r=[]){return this.store.tx((async()=>{let{id:n,msg:s,gas_limit:a,reply_on:o}=e,c=await this.chain.handleMsg(t,s,r);if(c.ok){let{events:e,data:s}=c.val;if(o===l.ReplyOn.Success||o===l.ReplyOn.Always){let a={id:n,result:{ok:{events:e,data:(0,u.wrapReplyResponse)(c.val).data}}},o=await this.reply(t,a,r);if(o.err)return o;if("string"==typeof o.val)throw new Error(o.val.toString());null!==o.val.data&&(s=o.val.data),e=[...e,...o.val.events]}else s=null;return(0,i.Ok)({events:e,data:s})}const d=c.val.toString();if(d.startsWith("abort: panicked"))throw new Error(d);if(o===l.ReplyOn.Error||o===l.ReplyOn.Always){let e={id:n,result:{error:d}},s=await this.reply(t,e,r);if(s.err)return s;let{events:a,data:o}=s.val;return(0,i.Ok)({events:a,data:o})}return c}))}async reply(t,e,r=[]){const n=[],s=this.getContract(t),a=s.reply(e,n),o={[c.NEVER_IMMUTIFY]:!0,type:"reply",contractAddress:t,msg:e,env:s.getExecutionEnv(),logs:n,storeSnapshot:this.store.db.data};if(a.err)return r.push({...o,response:a,result:a}),a;const i={type:"reply",attributes:[{key:"_contract_address",value:t},{key:"mode",value:"ok"in e.result?"handle_success":"handle_failure"}]};if(a.err||"string"==typeof a.val)throw new Error(a.val.toString());let d=(0,u.buildAppResponse)(t,i,a.val),l=await this.handleContractResponse(t,a.val.messages,d,[]);return r.push({...o,response:a,result:l,storeSnapshot:this.store.db.data}),l}query(t,e){return this.getContract(t).query(e)}queryTrace(t,e){let{contractAddress:r,storeSnapshot:n}=t;return this.getContract(r).query(e,n)}async handleMsg(t,e,r=[]){return this.store.tx((async()=>{let n=e;if("execute"in n){let{contract_addr:e,funds:a,msg:o}=n.execute;return await this.executeContract(t,a,e,(0,s.fromBinary)(o),r)}if("instantiate"in n){let{code_id:e,funds:a,msg:o,label:i,admin:c}=n.instantiate;return await this.instantiateContract(t,a,e,(0,s.fromBinary)(o),i,c,r)}if("migrate"in n){let{contract_addr:e,new_code_id:a,msg:o}=n.migrate;return await this.migrateContract(t,a,e,(0,s.fromBinary)(o),r)}throw new Error("Unknown wasm message")}))}handleQuery(t){if("smart"in t){const{contract_addr:e,msg:r}=t.smart,n=this.query(e,(0,s.fromBinary)(r));if(n.ok)return n.val;const a=n.val.toString();return a.startsWith("Divide by zero:")?"0":(0,i.Err)(a)}if("raw"in t){const{contract_addr:e,key:r}=t.raw,n=this.getContractStorage(e);if(!n)throw new Error(`Contract ${e} not found`);const s=this.chain.kvIterStorageRegistry===l.BinaryKVIterStorage?(0,a.toBase64)(n.get((0,a.fromBase64)(r))):n.get(r);if(void 0===s)throw new Error(`Key ${r} not found`);return s}if("contract_info"in t){const{contract_addr:e}=t.contract_info,r=this.getContractInfo(e);if(void 0===r)throw new Error(`Contract ${e} not found`);const{codeId:n,creator:s,admin:a}=r;return{code_id:n,creator:s,admin:a,ibc_port:this.chain.ibc.getContractIbcPort(e),pinned:!0}}throw new Error("Unknown wasm query")}lens(t){return t?p(t):this.store}pushTrace(t,e){t.push({[c.NEVER_IMMUTIFY]:!0,...e,env:this.getExecutionEnv(e.contractAddress)})}get lastCodeId(){return this.store.get("lastCodeId")}get lastInstanceId(){return this.store.get("lastInstanceId")}}function p(t){return new c.Transactional(t).lens("wasm")}e.WasmModule=h,e.lensFromSnapshot=p},411:function(t,e,r){var n=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0}),e.buildAppResponse=e.buildContractAddress=e.wrapReplyResponse=void 0;const s=r(387),a=n(r(284)),o=r(101),i=r(567),c=a.default.Root.fromJSON({nested:{MsgInstantiateContractResponse:{fields:{address:{type:"string",id:1},data:{type:"bytes",id:2}}}}});e.wrapReplyResponse=function(t){const e=c.lookupType("MsgInstantiateContractResponse"),r={data:t.data,address:null};for(const e of t.events){const t=e.attributes.find((t=>"_contract_address"===t.key))?.value;if(t){r.address=t;break}}const n=e.create(r);return{events:t.events,data:(0,i.toBase64)(e.encode(n).finish())}},e.buildContractAddress=function(t,e){const r=Buffer.alloc(21);r.write("wasm"),(0,o.writeUInt32BE)(r,t,9),(0,o.writeUInt32BE)(r,e,17);let n=new s.Sha256;n.update(Buffer.from("module","utf-8"));let a=n.digest();return n=new s.Sha256(a),n.update(r),n.digest().slice(0,20)},e.buildAppResponse=function(t,e,r){const n=[];n.push(e),r.attributes.length>0&&n.push({type:"wasm",attributes:[{key:"_contract_address",value:t},...r.attributes]});for(const e of r.events)n.push({type:`wasm-${e.type}`,attributes:[{key:"_contract_address",value:t},...e.attributes]});return{events:n,data:r.data}}},255:function(t,e,r){var n=this&&this.__createBinding||(Object.create?function(t,e,r,n){void 0===n&&(n=r);var s=Object.getOwnPropertyDescriptor(e,r);s&&!("get"in s?!e.__esModule:s.writable||s.configurable)||(s={enumerable:!0,get:function(){return e[r]}}),Object.defineProperty(t,n,s)}:function(t,e,r,n){void 0===n&&(n=r),t[n]=e[r]}),s=this&&this.__setModuleDefault||(Object.create?function(t,e){Object.defineProperty(t,"default",{enumerable:!0,value:e})}:function(t,e){t.default=e}),a=this&&this.__importStar||function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var r in t)"default"!==r&&Object.prototype.hasOwnProperty.call(t,r)&&n(e,t,r);return s(e,t),e};Object.defineProperty(e,"__esModule",{value:!0}),e.load=e.save=e.serde=void 0;const o=a(r(766)),i=r(934),c=r(989),d=r(543),u=r(92);e.serde=(0,o.default)().standard().setSimple("immutable-list",((t,e)=>({data:e(t.toArray()),mutable:!!t.__ownerID})),(({data:t,mutable:e},r)=>{if(!t.length)return(0,c.List)();const n=(0,c.List)().asMutable();return i.Reference.all(r,t,(t=>{n.push(...t),!e&&n.asImmutable()})),n})).setSimple("immutable-map",((t,e)=>({data:e(t.toObject()),mutable:!!t.__ownerID})),(({data:t,mutable:e},r)=>{const n=(0,c.Map)().asMutable(),s=Object.keys(t);return s.length?(i.Reference.all(r,s.map((e=>t[e])),(t=>{t.forEach(((t,e)=>{const r=s[e];n.set(r,t)})),!e&&n.asImmutable()})),n):(0,c.Map)()})).setSimple("cw-simulate-app",(t=>({chainId:t.chainId,bech32Prefix:t.bech32Prefix,store:t.store.db.data})),(({chainId:t,bech32Prefix:e,store:r},n)=>{const s=new u.CWSimulateApp({chainId:t,bech32Prefix:e});return i.Reference.all(n,[r],(([t])=>{s.store.db.tx((e=>(e((()=>t)),(0,d.Ok)(void 0))))})),s})),e.save=t=>e.serde.serializeAs("cw-simulate-app",t).compress().buffer,e.load=async t=>{const r=e.serde.deserializeAs("cw-simulate-app",t),n=[...r.wasm.store.get("contracts").keys()];return await Promise.all(n.map((t=>r.wasm.getContract(t).init()))),r},c.Map.prototype[o.SERDE]="immutable-map",c.List.prototype[o.SERDE]="immutable-list"},527:function(t,e,r){var n=this&&this.__createBinding||(Object.create?function(t,e,r,n){void 0===n&&(n=r);var s=Object.getOwnPropertyDescriptor(e,r);s&&!("get"in s?!e.__esModule:s.writable||s.configurable)||(s={enumerable:!0,get:function(){return e[r]}}),Object.defineProperty(t,n,s)}:function(t,e,r,n){void 0===n&&(n=r),t[n]=e[r]}),s=this&&this.__exportStar||function(t,e){for(var r in t)"default"===r||Object.prototype.hasOwnProperty.call(e,r)||n(e,t,r)};Object.defineProperty(e,"__esModule",{value:!0}),s(r(365),e)},365:(t,e,r)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.fromImmutable=e.toImmutable=e.TransactionalLens=e.Transactional=e.NEVER_IMMUTIFY=void 0;const n=r(989),s=r(543),a=r(882);e.NEVER_IMMUTIFY="__NEVER_IMMUTIFY__",e.Transactional=class{_data;constructor(t=(0,n.Map)()){this._data=t}lens(...t){return new o(this,t.map(d))}tx(t){let e=!0;const r=this._data,n=t=>{if(!e)throw new Error("Attempted to set data outside tx");this._data=t(this._data)};try{const s=t(n);return"then"in s?s.then((t=>(t.err&&(this._data=r),t))).catch((t=>{throw this._data=r,t})):(s.err&&(this._data=r),s)}catch(t){throw this._data=r,t}finally{e=!1}}get data(){return this._data}};class o{db;prefix;constructor(t,e){this.db=t,this.prefix=e}initialize(t){return this.db.tx((e=>{const r=i(t);if(!(0,n.isCollection)(r))throw new Error("Not an Immutable.Map");return e((t=>t.setIn([...this.prefix],r))),(0,s.Ok)(void 0)})).unwrap(),this}get(...t){return this.db.data.getIn([...this.prefix,...t.map(d)])}getObject(...t){return c(this.get(...t))}tx(t){return this.db.tx((e=>t(((...t)=>r=>{e((e=>e.setIn([...this.prefix,...t.map(d)],i(r))))}),((...t)=>{e((e=>e.deleteIn([...this.prefix,...t.map(d)])))}))))}lens(...t){return new o(this.db,[...this.prefix,...t.map(d)])}get data(){return this.db.data.getIn([...this.prefix])}}function i(t){return(0,n.isCollection)(t)?t:ArrayBuffer.isView(t)?(Object.freeze(t.buffer),t):t instanceof ArrayBuffer?(Object.freeze(t),t):t&&"object"==typeof t&&!(e.NEVER_IMMUTIFY in t)?(0,a.isArrayLike)(t)?(0,n.List)(t.map((t=>i(t)))):(0,n.Map)(Object.entries(t).map((([t,e])=>[t,i(e)]))):t}function c(t){if((0,n.isMap)(t))return c(t.toObject());if((0,n.isList)(t))return c(t.toArray());if(t instanceof ArrayBuffer||ArrayBuffer.isView(t))return t;if(t&&"object"==typeof t&&!(e.NEVER_IMMUTIFY in t)){if("number"==typeof t.length&&0 in t&&t.length-1 in t)for(let e=0;e<t.length;++e)t[e]=c(t[e]);else for(const e in t)t[e]=c(t[e]);return t}return t}e.TransactionalLens=o,e.toImmutable=i,e.fromImmutable=c;const d=t=>t+""},699:(t,e)=>{var r;Object.defineProperty(e,"__esModule",{value:!0}),e.IbcOrder=void 0,function(t){t.Unordered="ORDER_UNORDERED",t.Ordered="ORDER_ORDERED"}(r||(e.IbcOrder=r={}))},882:(t,e,r)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.printDebug=e.getTransactionHash=e.isTSResult=e.isRustResult=e.toRustResult=e.fromRustResult=e.isArrayLike=void 0;const n=r(543),s=r(387),a=r(567);e.isArrayLike=t=>"object"==typeof t&&"number"==typeof t.length,e.fromRustResult=function(t){if("ok"in t)return(0,n.Ok)(t.ok);if("string"==typeof t.error)return(0,n.Err)(t.error);throw new Error("Invalid RustResult type")},e.toRustResult=function(t){return t.ok?{ok:t.val}:{error:t.val}},e.isRustResult=t=>"ok"in t||"err"in t,e.isTSResult=t=>"boolean"==typeof t.ok&&"boolean"==typeof t.err&&"val"in t,e.getTransactionHash=(t,e,r)=>{const n=Buffer.from(JSON.stringify({data:e,height:t}),r);return(0,a.toHex)((0,s.sha256)(n))},e.printDebug=t=>{"print"===t.type&&console.log(t.message)}},799:t=>{t.exports=require("@cosmjs/cosmwasm-stargate")},387:t=>{t.exports=require("@cosmjs/crypto")},567:t=>{t.exports=require("@cosmjs/encoding")},766:t=>{t.exports=require("@kiruse/serde")},934:t=>{t.exports=require("@kiruse/serde/dist/types")},101:t=>{t.exports=require("@oraichain/cosmwasm-vm-js")},989:t=>{t.exports=require("@oraichain/immutable")},502:t=>{t.exports=require("eventemitter3")},284:t=>{t.exports=require("protobufjs")},543:t=>{t.exports=require("ts-results")},147:t=>{t.exports=require("fs")},17:t=>{t.exports=require("path")}},e={},r=function r(n){var s=e[n];if(void 0!==s)return s.exports;var a=e[n]={exports:{}};return t[n].call(a.exports,a,a.exports,r),a.exports}(607),n=exports;for(var s in r)n[s]=r[s];r.__esModule&&Object.defineProperty(n,"__esModule",{value:!0})})();
//# sourceMappingURL=bundle.node.js.map